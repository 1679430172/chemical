<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/web/component/layui/css/layui.css" th:src="@{/web/component/layui/css/layui.css}"  media="all">
    <script type="text/javascript" src="/web/component/js/jquery-3.3.1.min.js" th:src="@{/web/component/js/jquery-3.3.1.min.js}"></script>
    <script src="/web/component/layui/layui.js" th:src="@{/web/component/layui/layui.js}" ></script>
    <script type="text/javascript" >
        layui.use(["form","table","layer","upload"], function() {
            var table = layui.table;
            var form = layui.form;
            var layer = layui.layer;
            var upload = layui.upload;

            table.render({
                elem: '#demo'
                , url: '/Commoditys.do' //数据接口
                ,page:true
                ,limit:20
                ,toolbar: '#toolbarDemo'
                ,defaultToolbar:["filter"]
                ,limits:[1,3,5]
                , cols: [
                    [ //表头
                        {field: 'sid', title: '商品编号', width: 177}
                        ,{field: 'userName', title: '业务员名称'}
                        , {field: 'name', title: '产品名称'}
                        , {field: 'cas', title: 'cas号', sort: true}
                        , {field: 'createTime', title: '日期', sort: true}
                        , {field: 'updateTime', title: '更新日期', sort: true}
                        , {field: 'priceInfo', title: '报价信息', sort: true}
                        ,{field:'filePath',title:'图片预览',align: "center", templet: "#imgtmp" }
                        ,{field:"",title:'操作',toolbar:'#barDemo', width: 550}
                    ]
                ]
                ,done: function (response) {

                    upload.render({
                        elem: '#test1' //绑定元素
                        ,url: '/pictures.do' //上传接口
                        ,accept: 'images'
                        ,done: function(res){
                            layer.msg(res);
                            if(res == "1"){
                                layer.msg('导入成功!');
                                /*table.reload('demo', {
                                    url: '/Commoditys.do'
                                });*/
                            }
                            //上传完毕回调
                        }
                    });
                    //定位当前table视图
                    var tableView = this.elem.next();
                    $.each(response.data, function (index, item) {
                        console.log(item.amount);
                        //逻辑判断
                        if (item.amount > 0) {
                            //改变TR标签内字体颜色
                            tableView.find('tbody tr[data-index="' + index + '"]').css('background-color', '#33a1c9');
                            tableView.find('tbody tr[data-index="' + index + '"]').css('color', '#F0F0F0');
                        }else if(item.amount == 0){//
                            //改变TR标签内字体颜色
                            tableView.find('tbody tr[data-index="' + index + '"]').css('background-color', '#1E9FFF');
                            tableView.find('tbody tr[data-index="' + index + '"]').css('color', '#F0F0F0');
                        }else if(item.amount === null ){//00009C
                            console.log(item.amount);
                            tableView.find('tbody tr[data-index="' + index + '"]').addClass("layui-bg-cyan ");
                            tableView.find('tbody tr[data-index="' + index + '"]').css('color', '#F0F0F0');
                        }
                    })
                }
            })

            //执行实例


            //监听行工具
            table.on('tool(test)',function (obj) {
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                if(layEvent === 'detail'){
                    console.log(data);
                    layer.open({
                        type: 2,
                        //offset: 'auto',、
                        skin: 'layui-layer-rim',
                        area: ['314px', '300px'],
                        content: '/web/view/commoditySupplier.html?supplierId='+data.supplierId, //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                        end:function () {
                            table.reload('demo', {
                                url: '/Commoditys.do'
                            });
                        }
                    });
                }else if(layEvent == "test1"){
                    //执行实例
/*
                    upload.render({
                        elem: '#test1' //绑定元素
                        ,url: '/pictures.do' //上传接口
                        ,accept: 'images'
                        ,done: function(res){
                        layer.msg(res);
                        if(res == "1"){
                            layer.msg('导入成功!');
                            /!*table.reload('demo', {
                                url: '/Commoditys.do'
                            });*!/
                        }
                        //上传完毕回调
                    }
                });
*/
                }else if(layEvent == "test2"){
                    upload.render({
                        elem: '#test2' //绑定元素
                        ,url: '/pictures.do' //上传接口
                        ,accept: 'file'
                        ,done: function(res){
                            if(res == "1"){
                                layer.msg('导入成功!');
                                table.reload('demo', {
                                    url: '/Commoditys.do?'
                                });
                            }
                            //上传完毕回调
                        }
                        ,error: function(){
                            //请求异常回调
                        }
                    });
                }else if (layEvent == "edit"){
                    layer.open({
                        type: 2,
                        //offset: 'auto',、
                        skin: 'layui-layer-rim',
                        area: ['314px', '300px'],
                        content: '/web/view/commodityEdit.html?sid='+data.sid, //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                        end:function () {
                            table.reload('demo', {
                                url: '/Commoditys.do'
                            });
                        }
                    });
                }

            })

            //监听表头
            table.on('toolbar(test)',function (obj) {
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                if(layEvent === 'add'){
                    layer.open({
                        type: 2,
                        //offset: 'auto',、
                        skin: 'layui-layer-rim',
                        area: ['314px', '450px'],
                        content: '/web/view/commodityAdd.html', //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                        end:function () {
                            table.reload('demo', {
                                url: '/Commoditys.do'
                            });
                        }
                    });
                }
            })

            //监听表单
            form.on('submit(formDemo)', function(data){
                table.reload('demo', {
                    url: '/Commoditys.do'
                    ,where: data.field//设定异步数据接口的额外参数
                    //,height: 300
                });
                return false;
            });
        })
    </script>
</head>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit"><i class="layui-icon">&#xe615;</i>修改</a>
    <a class="layui-btn layui-btn-xs" lay-event="detail"><i class="layui-icon">&#xe615;</i>查看供应商</a>
    <button type="button" class="layui-btn layui-btn-xs" id="test1" lay-event="test1">
        <i class="layui-icon">&#xe67c;</i>未上传图片
    </button>
    <button type="button" class="layui-btn layui-btn-xs" id="test2" lay-event="test2">
        <i class="layui-icon">&#xe67c;</i>未上传文件
    </button>
</script>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="add"><i class="layui-icon">&#xe624;</i>添加</button>
    </div>
</script>
<body>
<form class="layui-form" action="">
    <div class="layui-inline">
        <div class="layui-input-block">
            <input type="text" id="createTime" name="createTime" required   placeholder="请输入开始时间" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-inline">
        <label class="layui-form-label">至</label>
        <div class="layui-input-block">
            <input type="text " id="createTimes" name="createTimes" required   placeholder="请输入结果时间" autocomplete="off" class="layui-input">
        </div>
    </div>
    <input type="text" style="display:none" id="uid" name="uid">
    <div class="layui-inline">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="formDemo">我的商品</button>
        </div>
    </div>
</form>
<table id="demo" lay-filter="test"></table>

</body>
</html>