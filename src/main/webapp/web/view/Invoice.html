<html >
<head>
    <meta charset="UTF-8">
    <title>发票管理</title>
    <link rel="stylesheet" href="/web/component/layui/css/layui.css" media="all">
    <script src="/web/component/layui/layui.js"></script>
    <script type="text/javascript" src="/web/component/js/jquery-3.3.1.min.js"></script>
</head>
<body>

<form class="layui-form" action="" lay-filter="example">
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">Cas号</label>
            <div class="layui-input-block">
                <input type="text" name="cas" lay-verify="title" autocomplete="off" placeholder="请输入" class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <div class="layui-input-block">
                <button type="submit" class="layui-btn" lay-submit="" lay-filter="formDemo">查询</button>
            </div>
        </div>
    </div>
</form>

<table id="demo" lay-filter="test"></table>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button type="button" class="layui-btn layui-btn-sm" lay-event="import" id="test1"><i class="layui-icon">&#xe654;</i>添加</button>
    </div>
</script>

<script type="text/javascript">
    layui.use(['layer','form','laydate','table'], function(){
        var table = layui.table;
        var upload = layui.upload;
        var form=layui.form;
        var laydate=layui.laydate;

        laydate.render({
            elem:'#date'
        });

        table.render({
            elem: '#demo'
            ,toolbar: '#toolbarDemo'
            ,url: '/Invoice/select' //数据接口
            ,page: true //开启分页
            ,limit:20
            ,limits:[10,20,30]
            ,cols: [[ //表头
                 {field: 'sid', title: 'ID'}
                ,{field: 'name', title: '发票品名'}
                ,{field: 'cas', title: 'Cas号'}
                ,{field:'number',title:'数量'}
                ,{field: 'price', title: '价格'}
                ,{field: 'createTime', title: '创建日期'}
                ,{fixed: 'right', align:'center', toolbar: '#barDemo'}
            ]]
        });

        //监听工具条
        table.on('tool(test)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）

            if(layEvent === 'detail'){ //查看
                layer.open({
                    area: ['450px', '400px'],
                    title:"发票详情",
                    type: 1,
                    content:
                        "<table class='layui-table'>  " +
                        "  <tr>" +
                        "    <td>发票品名</td>" +
                        "    <td>"+data.name+"</td>" +
                        "  </tr>" +
                        "  <tr>" +
                        "    <td>cas号</td>" +
                        "    <td>"+data.cas+"</td>" +
                        "  </tr>" +
                        "  <tr>" +
                        "    <td>数量</td>" +
                        "    <td>"+data.number+"</td>" +
                        "  </tr>" +
                        "  <tr>" +
                        "    <td>修改数量</td>" +
                        "    <td><input type='text' value='"+data.number+"'>       " +
                        "<button type=\"button\" class=\"layui-btn layui-btn-xs\">自动修改</button></td> " +
                        "  </tr>" +
                        "</table>"+
                        "<button type=\"button\" class=\"layui-btn layui-btn-sm\" >保存</button>"

                    //这里content是一个普通的String
                });
            } else { //编辑

            }
        });

        form.on('submit(formDemo)', function(data){
            table.reload('demo', {
                url: '/Invoice/queryByCas.do'
                ,where: data.field//设定异步数据接口的额外参数
            });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });

        //执行实例
        table.on('toolbar(test)', function(obj) {
            var layEvent = obj.event;
            if (layEvent === 'import') {
                layer.open({
                    area: ['500px', '600px'],
                    type: 2,
                    content: 'addInvoice.html',
                    end:function () {
                        table.reload('demo', {
                            url: '/Invoice/select.do'
                        });
                    },
                });
            }
        });
    });
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="detail"><i class="layui-icon">&#xe615;</i>自动计算数量</a>
</script>

</body>
</html>